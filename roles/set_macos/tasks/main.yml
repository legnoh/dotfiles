---

- name: Set macOS preferences
  block:
    - name: Copy script files
      ansible.builtin.copy:
        src: "defaults.sh"
        dest: "/tmp/defaults.sh"
        mode: '0755'

    - name: Execute script
      ansible.builtin.command:
        cmd: "/tmp/defaults.sh"
      changed_when: false

    - name: Copy dictionary files
      ansible.builtin.copy:
        src: "dictionary.plist"
        dest: "{{ ansible_env.HOME }}/Downloads/dictionary.plist"
        mode: '0644'

    - name: Create Sticky
      ansible.builtin.import_role:
        name: create_sticky
      vars:
        create_sticky_file: README.md
        create_sticky_name: macosdefaults

  always:
    - name: Remove Script file
      ansible.builtin.file:
        path: "/tmp/defaults.sh"
        state: absent
